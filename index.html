<!DOCTYPE html>
<html>
<head>
</head>
<body>

<pre>
	<code>
	</code>
</pre>

<style>
h1 { text-decoration: underline }
*[data-indentation="0"] {
	padding: 1px;
	margin: 1px;
	border: 1px solid red;
}
*[data-indentation="1"] {
	padding: 1px;
	margin: 1px;
	border: 1px solid purple;
}
</style>

<script>
const code = `
def add(x, y):
	return x + y

if __name__ == '__main__':
	print(add(1, 2))
`

const lines = code.split('\n')
const tokens = lines.map(line => ({
	text: line,
	indent: line.length - line.trimStart().length,
}))
let dom = ''

function parse(token, indentation = 0) {
	const { text, indent } = tokens[token]
	const peek = token + 1 < tokens.length
		? tokens[token + 1]
		: null
	
	dom += `<div class="token" data-indentation="${indentation}">`

	if (indent == indentation) {
		dom += text
	}
	else if (indent > indentation) {
		dom += `<div class="token" data-indentation="${indentation}">`
		parse(token, indent)
		dom += '</div>'
	}
	else if (indent < indentation) {
		dom += text // todo
	}

	dom += '</div>'

	if (peek) {
		parse(token + 1, indentation)
	}
}

parse(0)
document.querySelector('code').innerHTML = dom
console.log(dom)
</script>

</body>
</html>
